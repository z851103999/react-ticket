{"version":3,"sources":["../src/delay.ts"],"names":["delay","proxy","timer","mockApi","Object","keys","forEach","key","result","prototype","toString","call","test","req","res","foo","_req","_res","json","setTimeout"],"mappings":";;;;;;;AAGA;;;;;;;;;;;;;;;;;;AAkBe,SAASA,KAAT,CAAeC,KAAf,EAAyE;AAAA,MAAjCC,KAAiC,uEAAjB,CAAiB;AACtF,MAAMC,OAAqB,GAAG,EAA9B;AACAC,EAAAA,MAAM,CAACC,IAAP,CAAYJ,KAAZ,EAAmBK,OAAnB,CAA2B,UAACC,GAAD,EAAS;AAClC,QAAMC,MAAM,GAAGP,KAAK,CAACM,GAAD,CAApB;;AACA,QAAKH,MAAM,CAACK,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BH,MAA/B,MAA2C,iBAA3C,IAAgE,QAAQI,IAAR,CAAaJ,MAAb,CAAjE,IAAoGD,GAAG,KAAK,QAA5G,IAAwHL,KAAK,KAAK,CAAtI,EAAyI;AACvIC,MAAAA,OAAO,CAACI,GAAD,CAAP,GAAeN,KAAK,CAACM,GAAD,CAApB;AACD,KAFD,MAEO;AACLJ,MAAAA,OAAO,CAACI,GAAD,CAAP,GAAe,UAAUM,GAAV,EAAwBC,GAAxB,EAAuC;AACpD,YAAIC,GAAJ;;AACA,YAAIX,MAAM,CAACK,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BH,MAA/B,MAA2C,mBAA/C,EAAoE;AAClEO,UAAAA,GAAG,GAAGP,MAAN;AACD,SAFD,MAEO;AACLO,UAAAA,GAAG,GAAG,aAACC,IAAD,EAAgBC,IAAhB,EAAmC;AACvC,mBAAOA,IAAI,CAACC,IAAL,CAAUV,MAAV,CAAP;AACD,WAFD;AAGD;;AACDW,QAAAA,UAAU,CAAC,YAAM;AACfJ,UAAAA,GAAG,CAACF,GAAD,EAAMC,GAAN,CAAH;AACD,SAFS,EAEPZ,KAFO,CAAV;AAGD,OAZD;AAaD;AACF,GAnBD;AAqBA,SAAOC,OAAP;AACD","sourcesContent":["import { Request, Response } from 'express';\nimport { MockerProxyRoute, MockerResult, MockerResultFunction } from './';\n\n/**\n * You can use functional tool to enhance mock. [#17](https://github.com/jaywcjlove/webpack-api-mocker/issues/17)\n * \n * ```js\n * const delay = require('mocker-api/lib/delay');\n * const noProxy = process.env.NO_PROXY === 'true';\n * \n * const proxy = {\n *   'GET /api/user': {\n *     id: 1,\n *     username: 'kenny',\n *     sex: 6\n *   },\n *   // ...\n * }\n * module.exports = (noProxy ? {} : delay(proxy, 1000));\n * ```\n */\nexport default function delay(proxy: MockerProxyRoute, timer: number = 0): MockerResult {\n  const mockApi: MockerResult = {};\n  Object.keys(proxy).forEach((key) => {\n    const result = proxy[key];\n    if ((Object.prototype.toString.call(result) === '[object String]' && /^http/.test(result as string)) || key === '_proxy' || timer === 0) {\n      mockApi[key] = proxy[key];\n    } else {\n      mockApi[key] = function (req: Request, res: Response) {\n        let foo: MockerResultFunction;\n        if (Object.prototype.toString.call(result) === '[object Function]') {\n          foo = result as MockerResultFunction;\n        } else {\n          foo = (_req: Request, _res: Response) => {\n            return _res.json(result);\n          };\n        }\n        setTimeout(() => {\n          foo(req, res);\n        }, timer);\n      };\n    }\n  });\n\n  return mockApi;\n}"]}